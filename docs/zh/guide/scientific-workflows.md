# 复刻图表 (`/drawio replicate`)

使用结构化抽取和设计系统样式复刻现有图片或图表。

## 快速开始

```
/drawio replicate
[上传图片]
```

指定主题：

```
/drawio replicate with academic theme
[上传架构截图]
```

## 工作流程

```
步骤 1：接收输入
├── 图片上传（必需）
└── 可选：文字描述

步骤 2：配置
├── 选择领域（软件架构、科研等）
├── 选择主题（默认 tech-blue，论文用 academic）
└── 指定语言（中文/英文）

步骤 3：结构化抽取
├── 分析图片结构
├── 抽取为 YAML 规格：
│   ├── 带语义类型的节点
│   ├── 带连接器类型的边
│   └── 用于分组的模块
└── 缺失信息标记为"未提及"

步骤 4：转换为图表
├── 应用选定主题
├── 计算 8px 网格位置
└── 生成 draw.io XML

步骤 5：实时预览
└── 图表在浏览器中显示
```

## 设计系统集成

### 按领域选择主题

| 领域 | 推荐主题 | 原因 |
|------|----------|------|
| 软件架构 | `tech-blue` | 专业技术风格 |
| 商业流程 | `tech-blue` | 简洁企业外观 |
| 科研流程 | `academic` | IEEE 兼容，灰度安全 |
| 工业流程 | `tech-blue` | 清晰技术图表 |
| 演示文稿 | `dark` | 幻灯片、视频内容 |
| 教学设计 | `nature` | 友好、易读的颜色 |

### 语义形状映射

抽取过程中，视觉元素映射到语义类型：

| 视觉元素 | 语义类型 | Draw.io 形状 |
|----------|----------|--------------|
| 矩形/方框 | `service` | 圆角矩形 |
| 圆柱/桶形 | `database` | 圆柱体 |
| 菱形 | `decision` | 菱形 |
| 椭圆/圆角矩形 | `terminal` | 体育场形 |
| 平行四边形 | `queue` | 平行四边形 |
| 人形/火柴人 | `user` | 圆形 |
| 文档形状 | `document` | 波浪矩形 |
| 数学公式 | `formula` | 带边框白色矩形 |

### 连接器类型映射

| 视觉样式 | 连接器类型 | 输出样式 |
|----------|------------|----------|
| 实线箭头 | `primary` | 实线 2px，填充箭头 |
| 虚线箭头 | `data` | 虚线 2px，填充箭头 |
| 点线 | `optional` | 点线 1px，空心箭头 |
| 菱形端点 | `dependency` | 实线 1px，菱形 |
| 双向箭头 | `bidirectional` | 实线 1.5px，无箭头 |

## 输入示例

### 仅图片

```
/drawio replicate
[上传图片]
```

### 指定主题

```
/drawio replicate with academic theme
[上传论文图片]
这是我们研究论文中的图片
```

### 带领域 + 主题

```
/drawio replicate
【领域】软件架构
【主题】tech-blue
【语言】中文
[上传图片]
这是我们的微服务架构图，请按设计系统标准重绘
```

### 学术论文

```
/drawio replicate with academic theme
【领域】科研流程
[上传论文图片]
这是论文中的实验流程图，需要 IEEE 标准化重绘
```

## 输出格式

抽取生成 YAML 规格：

```yaml
meta:
  theme: tech-blue
  layout: horizontal
  source: replicated

nodes:
  - id: n1
    label: API Gateway
    type: service
    module: frontend

  - id: n2
    label: 用户数据库
    type: database
    module: data

edges:
  - from: n1
    to: n2
    type: data
    label: 查询

modules:
  - id: frontend
    label: 前端层
  - id: data
    label: 数据层
```

## 抽取规则

⚠️ **硬规则（违反将导致重新生成）：**

1. **仅使用输入内容** - 不要添加推断内容
2. **缺失标记为"未提及"** - 不要猜测
3. **应用语义类型** - 将视觉元素映射到设计系统类型
4. **模块 ≤ 5** - 必要时合并
5. **每模块节点：3-7** - 过多时概括
6. **标签 ≤ 14 字符** - 标签中无符号
7. **使用类型化连接器** - 将线条样式映射到连接器类型

## 复杂度护栏

| 指标 | 阈值 | 建议 |
|------|------|------|
| 节点 | > 20 | 拆分为子图表 |
| 边 | > 30 | 使用层次布局 |
| 模块 | > 5 | 创建独立图表 |
| 标签长度 | > 14 字符 | 缩写或使用提示 |

## 故障排除

### 图片太复杂？
- 拆分为多个图表（每个最多 20-30 个节点）
- 一次专注一个模块
- 对大结构使用层次布局

### 颜色与原图不匹配？
- 设计系统应用一致的主题颜色
- 原始颜色映射到语义类型
- 使用显式样式覆盖自定义颜色

### 形状与原图不同？
- 设计系统映射到语义形状
- 规格中可用显式 `type:` 覆盖
- 查看语义形状文档

### 文本标签被截断？
- 保持标签 ≤ 14 字符
- 使用缩写
- 将详细信息移至提示或注释

## 相关链接

- [创建图表](./creating-diagrams.md) - `/drawio create` 工作流
- [编辑图表](./editing-diagrams.md) - `/drawio edit` 工作流
- [设计系统](./design-system.md) - 主题、形状、连接器
- [规格格式](./specification.md) - YAML 规格参考
- [数学公式排版](./math-typesetting.md) - LaTeX 支持
