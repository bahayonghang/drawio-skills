# Design: Two Skills Workflows for Scientific Process Diagrams

## Scope
本设计仅定义“工作流模板（prompt workflow）”与其边界约束，用于把“正文/架构图”转为可粘贴给 Nano Banana Pro 的【A–H 绘图 Prompt】。draw.io 的创建/编辑/导出仍由现有 MCP 工具链完成。

## Definitions
- **正文**：用户粘贴的基金标书/论文正文（中英文混合可）。
- **架构图**：用户提供的架构图（图片/截图/导出的 `.drawio`/SVG 等）或其文字说明。
- **A–H Prompt**：最终对外唯一输出，严格遵守用户给定硬规则。
- **文字设计稿**：用于内部结构化（模块目的、节点候选、因果关系草案）。
- **ASCII 草图**：用于内部快速核对布局与主流程方向（不作为最终输出）。

---

## Workflow 1：从零开始构建 drawio 的工作流

### 目标
从“正文”抽取对象/工艺、采集/干预、数据处理、（若正文有）AI建模验证、（若正文有）部署闭环、产出，并压缩成 ≤4 模块、每模块 3–5 节点，输出 A–H Prompt。

### Inputs
- 正文（必填）：`<<<在此粘贴>>>`

### Processing Steps (文字设计稿 → ASCII → A–H)
1. **信息抽取（只取明示）**
   - 抽取：对象或工艺对象、分组队列、流程实验、方法指标、样本量、统计/质控/伦理、分析步骤、结果或预期产出
   - 若未写明：记录为“未提及”
2. **因果顺序骨架**
   - 固定顺序：对象或工艺 → 采集检测或干预 → 数据处理 → AI建模验证（正文有才写）→ 部署闭环（正文有才写）→ 产出
3. **模块划分**
   - 模块数 ≤4；每模块写一句目的
   - 每模块节点 3–5 个（不足则合并概括，仍不新增含义）
4. **节点与连线草案**
   - 节点 Label：≤14 字中文短语；不含编号、字母、括号、标点或符号
   - 节点 ID：仅用于连线 N1/N2…，不上图
   - 连线：关系=因果/并行/分支/反馈；线型=实线箭头（主流程）/虚线箭头（数据或相关）/T形抑制（仅正文写明约束或联锁时）
5. **ASCII 草图（内部核对）**
   - 16:9，上→下主流程，左→右阅读顺序；模块分区清晰
6. **生成最终 A–H Prompt（唯一对外输出）**
   - 严格输出 A→H 八段，不允许输出其他文字
   - 缺失信息写“未提及”，不得推断

### ASCII 草图示例（结构示意，非最终输出）
```
┌──────────────────────────┐
│ 模块1：对象或工艺对象     │
│  [N1] → [N2] → [N3]       │
└──────────────────────────┘
              │
              ▼
┌──────────────────────────┐
│ 模块2：采集检测或干预     │
│  [N4] → [N5] → [N6]       │
└──────────────────────────┘
              │
              ▼
┌──────────────────────────┐
│ 模块3：数据处理           │
│  [N7] → [N8] → [N9]       │
└──────────────────────────┘
              │
              ▼
┌──────────────────────────┐
│ 模块4：产出               │
│  [N10] → [N11] → [N12]    │
└──────────────────────────┘
```

---

## Workflow 2：根据已有架构图进行复刻

### 目标
基于“已有架构图”（或其导出/说明）识别图中明确出现的对象/流程/数据处理/（若存在）AI环节/产出，并在不新增含义的前提下，输出同样严格的 A–H Prompt，用于下游复刻绘制。

### Inputs
- 架构图（必填）：图片/截图/`.drawio`/SVG/或文字化描述
- 正文（可选）：用于补充架构图里同样明示的信息；若缺失则“未提及”

### Processing Steps (文字设计稿 → ASCII → A–H)
1. **架构图信息抽取（只取图中明示）**
   - 仅抽取：图上出现的对象/工艺、采集检测/干预、数据处理、（若出现）AI建模验证、（若出现）部署闭环、产出
   - 图上未出现但正文出现：可补充；两者都未出现：写“未提及”
2. **映射到固定因果顺序**
   - 若原图为并行/反馈结构：在 D 中用“并行/反馈”表达，但整体阅读顺序仍保持上→下主流程
3. **压缩与规整**
   - 模块 ≤4；每模块 3–5 节点；节点过多时合并概括但不新增含义
4. **ASCII 草图（内部核对）**
   - 保留原图的关键信息结构：主干、分支、反馈；避免元素重叠
5. **生成最终 A–H Prompt（唯一对外输出）**
   - 严格遵守硬规则（尤其是：禁止补充未写内容、缺失信息写“未提及”、Label 限制）

### ASCII 草图示例（结构示意，非最终输出）
```
┌──────────────┐     ┌──────────────┐
│ 模块1：对象   │     │ 模块2：采集   │
│  [N1]         │ ─→  │  [N2] [N3]    │
└──────────────┘     └──────────────┘
           │                   │
           ▼                   ▼
     ┌──────────────┐   ┌──────────────┐
     │ 模块3：处理   │ → │ 模块4：产出   │
     │  [N4] [N5]    │   │  [N6] [N7]    │
     └──────────────┘   └──────────────┘
```

---

## Guardrails (工作流质量门禁)
1. **输出契约门禁**
   - 仅允许 A–H 八段输出
   - 任何额外解释、前后缀文本都视为失败
2. **信息边界门禁**
   - 只允许正文/架构图中明示的信息；缺失信息必须“未提及”
   - 禁止引入未出现的 AI/工业应用词（除非正文出现）
3. **结构门禁**
   - 模块 ≤4；每模块 3–5 节点；节点 Label ≤14 字且无符号
   - 连线关系/线型只用允许集合

